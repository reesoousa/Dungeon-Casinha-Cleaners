<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Cleaners RPG</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header id="app-header" style="display:none;">
        <div class="logo">
            <i data-lucide="castle" style="width: 26px; height: 26px;"></i>
            <span>DUNGEON CLEANERS</span>
        </div>
        <div class="header-actions">
            <div class="gold-display">
                <i data-lucide="coins" style="width: 22px; height: 22px;"></i>
                <span id="total-gold">0</span>
            </div>
            <button class="icon-btn header-action" onclick="openManagementModal()" aria-label="Gerenciar">
                <i data-lucide="settings" style="width: 22px; height: 22px;"></i>
            </button>
        </div>
    </header>

    <div class="container">
        <!-- SETUP SCREEN -->
        <div id="screen-setup" class="screen active">
            <div class="setup-box">
                <h1>
                    <i data-lucide="sword" style="width: 28px; height: 28px;"></i>
                    Bem-vindos!
                </h1>
                <p>Quem vai limpar a masmorra hoje?</p>
                <div style="margin-top: 30px;">
                    <input type="text" id="p1-name" placeholder="Nome do Jogador 1" value="Renan">
                    <input type="text" id="p2-name" placeholder="Nome do Jogador 2" value="Daisy">
                    <button class="btn btn-primary btn-block" onclick="startGame()">
                        <i data-lucide="play" style="width: 22px; height: 22px;"></i>
                        Começar Aventura
                    </button>
                </div>
            </div>
        </div>

        <!-- DUNGEON SCREEN -->
        <div id="screen-dungeon" class="screen">
            <div class="daily-status">
                <div class="daily-date">
                    <i data-lucide="calendar-days" style="width: 24px; height: 24px;"></i>
                    <div>
                        <div class="daily-date-label">Dia de hoje</div>
                        <div id="current-day" class="daily-date-value"></div>
                    </div>
                </div>
                <div class="daily-quests">
                    <div class="quest-item" id="quest-item-0">
                        <div class="quest-player" id="quest-player-0"></div>
                        <div class="quest-progress" id="quest-progress-0">0/2</div>
                    </div>
                    <div class="quest-item" id="quest-item-1">
                        <div class="quest-player" id="quest-player-1"></div>
                        <div class="quest-progress" id="quest-progress-1">0/2</div>
                    </div>
                </div>
            </div>

            <div class="streak-card">
                <div class="streak-icon">
                    <i data-lucide="star" style="width: 26px; height: 26px;"></i>
                </div>
                <div class="streak-content">
                    <div class="streak-title">Dias seguidos cuidando da dungeon</div>
                    <div class="streak-subtitle">Complete 1 tarefa hoje para manter o brilho!</div>
                    <div class="streak-progress">
                        <div class="streak-bar">
                            <div class="streak-fill" style="width: 60%;"></div>
                        </div>
                        <span class="streak-meta">Sequência ativa: 3 dias</span>
                    </div>
                </div>
            </div>

            <div class="time-selector">
                <label for="time-available">Tempo disponível</label>
                <div class="time-selector-controls">
                    <select id="time-available" onchange="updateTimeAvailable()">
                        <option value="infinite">Infinito</option>
                        <option value="5">5 minutos</option>
                        <option value="10">10 minutos</option>
                        <option value="15">15 minutos</option>
                        <option value="30">30 minutos</option>
                        <option value="60">60 minutos</option>
                    </select>
                    <div class="time-indicator" id="time-indicator">Nenhum tempo definido</div>
                </div>
                <div class="task-feedback" id="task-feedback"></div>
            </div>

            <div class="actions-area">
                <button class="btn btn-primary action-primary" onclick="openTaskModal()">
                    <i data-lucide="sword" style="width: 24px; height: 24px;"></i>
                    Invocar Tarefa
                </button>
                <div class="actions-secondary">
                    <button class="btn btn-danger action-secondary" onclick="openUrgentModal()">
                        <i data-lucide="bell-ring" style="width: 22px; height: 22px;"></i>
                        Monstro Urgente
                    </button>
                </div>
            </div>

            <div class="task-roll-status" id="task-roll-status"></div>

            <section id="urgent-section" class="urgent-section">
                <div class="section-title urgent-title">
                    <i data-lucide="bell-ring" style="width: 30px; height: 30px;"></i>
                    <span>Monstros Urgentes Emergentes!</span>
                </div>

                <div id="urgent-tasks" class="urgent-grid"></div>
            </section>

            <div class="section-title">
                <i data-lucide="flame" style="width: 30px; height: 30px;"></i>
                <span>Monstros na Mesa</span>
            </div>

            <div id="active-monsters" class="card-grid"></div>

            <div id="empty-dungeon" class="empty-state">
                <div class="empty-state-icon">
                    <i data-lucide="shield" style="width: 64px; height: 64px;"></i>
                </div>
                <div class="empty-state-text">
                    Prepare sua masmorra — gere suas tarefas!<br>
                    <strong>Invocar Tarefa</strong> abre novas cartas para hoje.
                </div>
            </div>
        </div>

        <!-- MAP SCREEN -->
        <div id="screen-map" class="screen">
            <div class="section-title">
                <i data-lucide="map" style="width: 30px; height: 30px;"></i>
                <span>Mapa da Dungeon</span>
            </div>

            <div class="map-summary">
                <div class="summary-card">
                    <div class="summary-header">
                        <div>
                            <div class="summary-title">Progresso da casa</div>
                            <div class="summary-subtitle">Visão macro do que foi limpo</div>
                        </div>
                        <div class="summary-badge" id="map-progress-label">0% limpo hoje</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="map-progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="summary-stats">
                        <div class="summary-stat recent">
                            <span>Concluídas</span>
                            <strong id="map-count-recent">0</strong>
                        </div>
                        <div class="summary-stat available">
                            <span>Disponíveis</span>
                            <strong id="map-count-available">0</strong>
                        </div>
                        <div class="summary-stat overdue">
                            <span>Atrasadas</span>
                            <strong id="map-count-overdue">0</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="map-legend">
                <div class="legend-item recent">
                    <span class="legend-dot"></span>
                    Concluída recentemente
                </div>
                <div class="legend-item available">
                    <span class="legend-dot"></span>
                    Disponível
                </div>
                <div class="legend-item overdue">
                    <span class="legend-dot"></span>
                    Atrasada
                </div>
                <div class="legend-item locked">
                    <span class="legend-dot"></span>
                    Bloqueada
                </div>
            </div>

            <div id="dungeon-map" class="dungeon-map"></div>

            <div class="map-detail-card" id="map-detail-card">
                <div class="map-detail-header">
                    <span class="map-detail-title">Selecione um nó do mapa</span>
                    <span class="map-detail-state">Explore a dungeon</span>
                </div>
                <p class="map-detail-description">
                    Toque em uma missão para ver detalhes rápidos, prioridade e sugestões.
                </p>
                <div class="map-detail-meta">
                    <span><i data-lucide="clock" style="width: 14px; height: 14px;"></i> Tempo: --</span>
                    <span><i data-lucide="repeat" style="width: 14px; height: 14px;"></i> Frequência: --</span>
                    <span><i data-lucide="calendar-check" style="width: 14px; height: 14px;"></i> Última vez: --</span>
                </div>
            </div>
        </div>

        <!-- TAVERN SCREEN -->
        <div id="screen-tavern" class="screen">
            <div class="section-title">
                <i data-lucide="shopping-bag" style="width: 30px; height: 30px;"></i>
                <span>Recompensas</span>
            </div>

            <div class="shop-item add-reward-card">
                <div class="shop-item-info">
                    <h3>Nova Recompensa</h3>
                    <p>Adicionar item à Wishlist</p>
                </div>
                <button class="btn" style="padding: 12px 20px;" onclick="addCustomReward()">
                    <i data-lucide="plus" style="width: 22px; height: 22px;"></i>
                </button>
            </div>

            <div id="shop-list"></div>
        </div>

        <!-- HISTORY SCREEN -->
        <div id="screen-history" class="screen">
            <div class="section-title">
                <i data-lucide="scroll-text" style="width: 30px; height: 30px;"></i>
                <span>Histórico</span>
            </div>

            <div class="history-tabs">
                <div class="history-tab active" onclick="switchHistoryTab('activity')">
                    <i data-lucide="check-circle" style="width: 18px; height: 18px;"></i>
                    <span>Atividades</span>
                </div>
                <div class="history-tab" onclick="switchHistoryTab('purchase')">
                    <i data-lucide="shopping-cart" style="width: 18px; height: 18px;"></i>
                    <span>Compras</span>
                </div>
            </div>

            <div id="activity-log" class="history-list active"></div>
            <div id="purchase-history" class="history-list"></div>
        </div>
    </div>

    <!-- MODAL DE SELEÇÃO DE TAREFA -->
    <div id="task-modal" class="modal-overlay" onclick="handleModalOutsideClick(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>
                <i data-lucide="cards" style="width: 24px; height: 24px;"></i>
                Escolha uma Tarefa
            </h2>
            <p class="modal-subtitle">Toque em uma das cartas para invocar o monstro</p>
            <div class="modal-time" id="modal-time"></div>
            <div class="modal-note" id="task-roll-note"></div>
            <div id="task-selection-cards" class="task-selection-grid"></div>
            <button class="btn btn-danger btn-block" id="discard-task-roll" onclick="discardTaskRoll()" style="margin-bottom: 10px;">
                Descartar 3 cartas
            </button>
            <button class="btn btn-block" onclick="closeTaskModal()">
                <i data-lucide="x" style="width: 20px; height: 20px;"></i>
                Cancelar
            </button>
        </div>
    </div>

    <!-- MODAL DE GERENCIAMENTO -->
    <div id="management-modal" class="modal-overlay" onclick="handleManagementOutsideClick(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>
                <i data-lucide="settings" style="width: 24px; height: 24px;"></i>
                Gerenciar Monstros
            </h2>
            <p class="modal-subtitle">Remova tarefas da mesa ou limpe tudo</p>

            <div class="management-list" id="management-list"></div>

            <button class="btn btn-danger btn-block" onclick="clearAllMonsters()" style="margin-bottom: 10px;">
                <i data-lucide="trash-2" style="width: 20px; height: 20px;"></i>
                Limpar Todos os Monstros
            </button>

            <button class="btn btn-block" onclick="closeManagementModal()">
                <i data-lucide="x" style="width: 20px; height: 20px;"></i>
                Fechar
            </button>
        </div>
    </div>

    <!-- MODAL DE URGÊNCIA -->
    <div id="urgent-modal" class="modal-overlay" onclick="handleUrgentOutsideClick(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>
                <i data-lucide="alert-triangle" style="width: 24px; height: 24px;"></i>
                Monstro Urgente
            </h2>
            <p class="modal-subtitle">Crie uma emergência rápida que ignora as regras normais.</p>

            <div class="urgent-form">
                <label for="urgent-name">O que aconteceu?</label>
                <input type="text" id="urgent-name" placeholder="Ex: Vazamento na cozinha" maxlength="60">

                <label for="urgent-urgency">Nível de urgência</label>
                <select id="urgent-urgency">
                    <option value="light">Leve</option>
                    <option value="medium">Média</option>
                    <option value="critical">Crítica</option>
                </select>

                <label for="urgent-time">Tempo estimado</label>
                <select id="urgent-time">
                    <option value="infinite">Sem limite</option>
                    <option value="5">5 minutos</option>
                    <option value="10">10 minutos</option>
                    <option value="15">15 minutos</option>
                    <option value="30">30 minutos</option>
                    <option value="60">60 minutos</option>
                </select>
            </div>

            <div class="urgent-status" id="urgent-status"></div>

            <button class="btn btn-danger btn-block" onclick="createUrgentTask()" style="margin-bottom: 10px;">
                <i data-lucide="zap" style="width: 20px; height: 20px;"></i>
                Criar Emergência
            </button>

            <button class="btn btn-block" onclick="closeUrgentModal()">
                <i data-lucide="x" style="width: 20px; height: 20px;"></i>
                Cancelar
            </button>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="bottom-nav" id="main-nav" style="display:none;">
        <button class="nav-btn active" onclick="switchTab('dungeon')">
            <i data-lucide="castle" style="width: 20px; height: 20px;"></i>
            <span>MASMORRA</span>
        </button>
        <button class="nav-btn" onclick="switchTab('map')">
            <i data-lucide="map" style="width: 20px; height: 20px;"></i>
            <span>MAPA</span>
        </button>
        <button class="nav-btn" onclick="switchTab('tavern')">
            <i data-lucide="shopping-bag" style="width: 20px; height: 20px;"></i>
            <span>TAVERNA</span>
        </button>
        <button class="nav-btn" onclick="switchTab('history')">
            <i data-lucide="scroll-text" style="width: 20px; height: 20px;"></i>
            <span>HISTÓRICO</span>
        </button>
        <button class="nav-btn" onclick="hardReset()">
            <i data-lucide="rotate-ccw" style="width: 20px; height: 20px;"></i>
        </button>
    </nav>


    <script src="assets/js/app.js" defer></script>
</body>
</html>
